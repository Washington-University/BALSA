//# sourceMappingURL=balsaUI.js.map
var process=process||{env:{NODE_ENV:"development"}};
window.onload=function(){$(".tablesorter.filterer").each(function(a,b){tablesorterInit(b)});$(".tablesorter:not(.filterer)").each(function(a,b){tableInit(b)});$(".pager").each(function(a,b){pagerInit(b)});$(".ajaxForm").each(function(a,b){$(b).submit(function(a){ajaxSubmitForm(a)})});$(".datasetLabels").each(function(a,b){$(b).change(function(a){adjustDatasetTabLabels()})});$("#addFilterButton").click(function(){addSearchFilter()});$('[data-toggle="popover"]').popover();$("#latestNews").length&&($.get("/news/latest",
function(a,b){$("#latestNews").html(a)}),updateRecentActivity());$("#searchForm").length&&($(".searchRefresh").each(function(a,b){$(b).change(function(a){refreshSearchResults()})}),$(".searchRefreshText").keyup(function(){refreshSearchResults()}),refreshSearchResults());$("#downloadModal").length&&$.get("/download/downloadModalContents/"+$("#datasetIdField").val()+"?version="+$("#versionIdField").val(),function(a,b){$("#downloadModalContents").html(a);IndeterminateCheckbox.init();$('input[type="checkbox"].indeterminate-checkbox').change(function(){checkFiles()});
$("input[name=file]").change(function(){estimateSize()});a=$("#itemIdField").val();$("#"+a).prop("checked",!0);$("#"+a).trigger("change");tablesorterInit($("#downloadFileTable"));pagerInit($("#downloadFileTable"));$('[data-toggle="popover"]').popover();"indeterminate-checkbox"!==$("#"+a).attr("class")&&$("#filesTabTab").tab("show")});$("#downloadStatsModal").length&&$.get("/"+$("#datasetTermField").val()+"/downloadStats/"+$("#datasetIdField").val(),function(a,b){$("#downloadStatsModalContents").html(a);
tablesorterInit($("#mostDownloadedScenesTable"));pagerInit($("#mostDownloadedScenesTable"))});$("#logoutButton").length&&setInterval(function(){var a=document.cookie.match("(^|;) ?balsaRecentActivityTime=([^;]*)(;|$)");(a=a?a[2]:0)&&!timeoutAlert&&174E4<Date.now()-a?timeoutAlert=bootbox.alert({message:"You will soon be automatically logged out due to lack of activity. Do you wish to remain logged in?",buttons:{ok:{label:"Yes"}},callback:function(){$.get("/login/keepAlive");updateRecentActivity()}}):
a&&timeoutAlert&&174E4>Date.now()-a&&(timeoutAlert.modal("hide"),timeoutAlert=null);a&&186E4<Date.now()-a&&location.reload(!0)},5E3);$(".accordion .card:first-child .card-body").addClass("show");$("#sceneFileSort").sortable({update:function(a,b){updateSceneFileOrder()}});updateRecentActivity()};function printDiv(a){w=window.open();w.document.write($("#"+a).html());w.print();w.close()}function gotoDatasetVersion(a){if(a=a.value)window.location=a;return!1}
function updateRecentActivity(){var a=new Date,b=a.getTime();a.setHours(a.getHours()+1);document.cookie="balsaRecentActivityTime="+b+";path=/;expires="+a.toUTCString()}var timeoutAlert=null;function approvalGranted(a,b){$("#seeker"+a).remove();$("#granted-approvals").append(b)}function approvalDenied(a){$("#seeker"+a).remove()}function approvalRevoked(a){$("#approved"+a).remove()}function tableInit(a){$(a).tablesorter({theme:"bootstrap",sortList:$(a).data("sort"),widthFixed:!1})}
function tablesorterInit(a){$(a).tablesorter({theme:"bootstrap",sortList:$(a).data("sort"),widthFixed:!1,widgets:["filter"],widgetOptions:{filter_reset:".reset",filter_cssFilter:$(a).data("cssfilter")}})}function pagerInit(a){$(a).tablesorterPager({container:$(a).find(".ts-pager"),cssGoto:".pagenum",removeRows:!1,output:"{startRow} - {endRow} / {filteredRows} ({totalRows})"});var b=$(a).data("rows")||"20";$(a).find(".pagesize").val(b);$(a).find(".pagesize").change()}
function newsToggle(){$("#collapseNews").collapse("toggle");"show more"===$("#newsToggle").text()?$("#newsToggle").text("show less"):$("#newsToggle").text("show more")}function ajaxSubmitForm(a){a.preventDefault();var b=$(a.target);a=b.attr("action");$.ajax({type:"POST",url:a,data:b.serialize(),success:function(a){eval(b.data("success"));updateRecentActivity()},error:function(a,e,d){eval(b.data("error"));updateRecentActivity()}})}
function reportingSuccess(){$("#reportIssuesModal").modal("hide");bootbox.alert("Message sent.");$("#issueTitle").val("");$("#issueContents").val("")}function sendingSuccess(){$("#contactUsModal").modal("hide");bootbox.alert("Message sent.")}function curatorSendingSuccess(){$("#contactCuratorsModal").modal("hide");bootbox.alert("Message sent.")}function passwordChanged(){$("#changePasswordModal").modal("hide");bootbox.alert("Password changed.")}
function checkFiles(){var a=",";$("input:checked[class=indeterminate-checkbox]").each(function(){a+=$(this).attr("dependencies")+","});$("input[name=file]").each(function(){a.includes(","+this.id+",")?$(this).prop("checked",!0):$(this).prop("checked",!1);$(this).prev().html(this.checked?"0":"1")});$("#downloadFileTable").trigger("update");estimateSize()}
function estimateSize(){var a=0;$("input:checked[name=scene]").each(function(){a+=parseInt($(this).attr("zipsize"),10)});$("input:checked[name=file]").each(function(){a+=parseInt($(this).attr("zipsize"),10)});$("#zipsize").text(formatBytes(a))}function formatBytes(a){return 1024>a?a+" bytes":1048576>a?(a/1024).toFixed(0)+" KB":1073741824>a?(a/1048576).toFixed(1)+" MB":(a/1073741824).toFixed(2)+" GB"}
function presubmitCheck(){var a=",";$("input:checked[class=indeterminate-checkbox]").each(function(){a+=$(this).attr("dependencies")+","});var b=!0;$("input[name=file]").each(function(){a.includes(","+this.id+",")&&($(this).prop("checked")||(b=!1))});b?($("#downloadForm").submit(),$("#downloadModal").modal("hide")):bootbox.confirm("The items you have selected for download do not include all of the files marked as required by the scenes you have selected. This could cause problems with displaying the selected scenes. Do you wish to proceed?",
function(a){a&&($("#downloadForm").submit(),$("#downloadModal").modal("hide"))})}function scrollToHighlight(){window.setTimeout(function(){var a=$("#thumbnails");if(a.length){var b=a.scrollTop(),c=a.offset().top,e=c+a.height(),d=$(".carousel-indicators .active"),f=d.offset().top-35;d=f+d.height()+45;f<c&&a.animate({scrollTop:b-c+f},600);d>e&&a.animate({scrollTop:b-e+d},600)}},0)}scrollToHighlight();
$(".dropdown.keep-open").on({"shown.bs.dropdown":function(){this.closable=!1},click:function(){this.closable=!0},"hide.bs.dropdown":function(){return this.closable}});function updatePubMedButton(a){a.value?$("#pubMedDataModalButton").removeAttr("disabled"):$("#pubMedDataModalButton").attr("disabled","disabled")}var pubMedDoi="",pubMedJournal="",pubMedAuthors="",pubMedAbstract="";
function fetchPubMedData(){$("#pubMedDataLoading").show();$("#pubMedData").hide();$("#pubMedError").hide();$("#populatePubMedButton").attr("disabled","disabled");pubMedAbstract=pubMedAuthors=pubMedJournal=pubMedDoi="";$.get("/study/getPubMedData/"+$("#pmidField").val(),function(a,b){a.errorMessage?($("#pubMedError").html(a.errorMessage),$("#pubMedDataLoading").hide(),$("#pubMedError").show()):($("#pubMedDoi").text(a.doi),$("#pubMedJournal").text(a.journalName),$("#pubMedAuthors").html(a.authorlist.join("<br>")),
$("#pubMedAbstract").text(a.studyAbstract),pubMedDoi=a.doi,pubMedJournal=a.journalName,pubMedAuthors=a.authorlist.join("\r\n"),pubMedAbstract=a.studyAbstract,$("#populatePubMedButton").removeAttr("disabled"),$("#pubMedDataLoading").hide(),$("#pubMedData").show())});updateRecentActivity()}function populatePubMedData(){$("#doi").val(pubMedDoi);$("#publicationName").val(pubMedJournal);$("#authors").val(pubMedAuthors);$("#studyAbstract").val(pubMedAbstract)}$(function(){$(".datetimepicker").datetimepicker()});
function updateSceneFileOrder(){$("#sceneFileOrder").val($("#sceneFileSort").sortable("toArray"))}function changeFocusScene(){var a=$("#focusScene :selected").data("preview");a&&$("#focusScenePreview").html('<img src="/scene/image/'+a+'"/>')}
function userSearch(){var a=$("#search_text").val();a?($.get("/profile/search",{searchText:a},function(a){$("#usernames").find("option").remove();$.each(a,function(a,b){$("#usernames").append($("<option>",{value:b,text:b}))})}),updateRecentActivity()):$("#usernames").find("option").remove()}function addToOwners(){$("#usernames option:selected").each(function(){$("#ownerNames").val($("#ownerNames").val()+($("#ownerNames").val()?"\r\n":"")+$(this).text())})}
function addToViewers(){$("#usernames option:selected").each(function(){$("#viewerNames").val($("#viewerNames").val()+($("#viewerNames").val()?"\r\n":"")+$(this).text())})}$("#institutionSearch").keypress(function(a){if(13===a.keyCode)return a.preventDefault(),!1});
function searchInstitutions(){var a=$("#institutionSearch").val();$.get("/institution/search",{searchText:a},function(a){$("#institutionSearchResults").find("option").remove();$.each(a,function(a,b){$("#institutionSearchResults").append($("<option>",{value:b,text:b}))})});updateRecentActivity()}
function addToInstitutions(){$("#institutionSearchResults option:selected").each(function(){$("#institutionsList").val($("#institutionsList").val()+($("#institutionsList").val()?"\r\n":"")+$(this).text())})}
function searchPublications(){var a=$("#publicationSearch").val();$.get("/publication/search",{searchText:a},function(a){$("#publicationSearchResults").find("option").remove();$.each(a,function(a,b){$("#publicationSearchResults").append($("<option>",{value:b,text:b}))})});updateRecentActivity()}function setPublication(){$("#publicationSearchResults option:selected").each(function(){$("#publicationName").val($(this).text())})}var customTermsTitle=$("#customTermsTitle").val(),customTermsContent=$("#customTermsContent").val();
function customTermsCancel(){$("#customTermsTitle").val(customTermsTitle);$("#customTermsContent").val(customTermsContent)}function customTermsOkay(){customTermsTitle=$("#customTermsTitle").val();customTermsContent=$("#customTermsContent").val();customTermsTitle?$("#customTermsTitleDisplay").text(customTermsTitle):$("#customTermsTitleDisplay").text("No custom terms")}function successfulSave(a){bootbox.alert(a)}
function filterTags(){var a=$("#filterCategory").val();$("#editScenesForm "+(a?".category"+a.replaceAll(" ",""):"")+".tagCategory:not(:visible)").removeClass("d-none");a&&$(".tagCategory:not(.category"+a.replaceAll(" ","")+")").addClass("d-none");var b=[];$("#editScenesForm .tagCategory:visible").each(function(){b.push($(this).data("tag"))});$("#tagDisplay "+(a?".category"+a.replaceAll(" ",""):"")+":not(:visible)").each(function(){b.includes($(this).data("tagvalue"))||$(this).removeClass("d-none")});
for(a=0;a<b.length;a++)$('#tagDisplay [data-tagvalue="'+b[a]+'"]:visible').addClass("d-none")}function changeSceneListItem(a){$(".scene-list-item.active").removeClass("active");$(a).addClass("active")}function viewDatasetData(){$(".sceneData:not(.d-none)").addClass("d-none");$("#datasetData").removeClass("d-none");filterTags()}function viewSceneFileData(a){$(".sceneData:not(.d-none)").addClass("d-none");$("#sceneFileData"+a).removeClass("d-none");filterTags()}
function viewSceneData(a){$(".sceneData:not(.d-none)").addClass("d-none");$("#sceneData"+a).removeClass("d-none");filterTags()}
function addTag(a){var b=$(".sceneData:not(.d-none)");var c="datasetData"===b.attr("id")?$('.tagContainer:not(:has([data-tag="'+a+'"]))'):b.attr("id").startsWith("sceneFileData")?$("#"+b.attr("id")+' .tagContainer:not(:has([data-tag="'+a+'"])), [data-scenefile="'+b.attr("id")+'"] .tagContainer:not(:has([data-tag="'+a+'"]))'):$("#"+b.attr("id")+' .tagContainer:not(:has([data-tag="'+a+'"]))');c.append($("#tagTemplate").html().replace(/TAGVALUE/g,a).replace(/CATEGORYVALUE/g,a.substring(0,a.indexOf(":")).replaceAll(" ",
"")));c.find(".tagString").val(function(){return this.value+(this.value?",":"")+a});b.attr("id").startsWith("sceneData")&&0===$('[data-scenefile="'+b.data("scenefile")+'"]:not(:has([data-tag="'+a+'"]))').length&&$("#"+b.data("scenefile")+" .tagContainer").append($("#tagTemplate").html().replace(/TAGVALUE/g,a).replace(/CATEGORYVALUE/g,a.substring(0,a.indexOf(":")).replaceAll(" ","")));(b.attr("id").startsWith("sceneData")||b.attr("id").startsWith("sceneFileData"))&&0===$('.sceneFileData:not(:has([data-tag="'+
a+'"]))').length&&$("#datasetData .tagContainer").append($("#tagTemplate").html().replace(/TAGVALUE/g,a).replace(/CATEGORYVALUE/g,a.substring(0,a.indexOf(":")).replaceAll(" ","")));filterTags()}
function removeTag(a){var b=$(".sceneData:not(.d-none)");b="datasetData"===b.attr("id")?$('.tagContainer:has([data-tag="'+a+'"])'):b.attr("id").startsWith("sceneFileData")?$("#"+b.attr("id")+':has([data-tag="'+a+'"]), [data-scenefile="'+b.attr("id")+'"]:has([data-tag="'+a+'"]), #datasetData:has([data-tag="'+a+'"])'):$("#"+b.attr("id")+':has([data-tag="'+a+'"]), #'+b.data("scenefile")+':has([data-tag="'+a+'"]), #datasetData:has([data-tag="'+a+'"])');b.find('[data-tag="'+a+'"]').remove();b.find(".tagString").val(function(){return(this.value.substring(0,
this.value.indexOf(a))+this.value.substring(this.value.indexOf(a)+a.length)).replace(",,",",").replace(/(^,)|(,$)/g,"")});filterTags()}
function uploadFile(){$("#uploadAccordionButton").click();var a=$("#fileUpload").prop("files")[0],b=new XMLHttpRequest;b.open("POST","/"+$("#fileUpload").data("controller")+"/handleUpload/"+$("#fileUpload").data("datasetid"));b.setRequestHeader("X-File-Name",encodeURIComponent(a.name?a.name:a.fileName));b.setRequestHeader("X-File-Size",a.size?a.size:a.fileSize);b.upload.addEventListener("progress",function(a){$("#uploadProgressBar").width(a.loaded/a.total*100+"%")},!1);b.upload.addEventListener("load",
function(a){$("#processUploadButton").removeClass("disabled");$("#processUploadButton").removeClass("btn-secondary");$("#processUploadButton").addClass("btn-primary")},!1);b.send(a)}var agreementChanged=!1;
function agree(a){$("#title"+a).html("&#10003;");$("#title"+a).removeClass("text-danger");$("#title"+a).removeClass("text-warning");$("#title"+a).addClass("text-success");$("#button"+a).removeClass("btn-primary");$("#button"+a).addClass("btn-light");$("#button"+a).attr("disabled","disabled");$("#button"+a).html('<span class="text-success font-weight-bold">&#10003;</span> Agreed')}function displayError(a){409===a&&$("#cdbErrorModal").modal("toggle")}
function checkTermsReload(){0===$(".terms-title .text-danger").length&&location.reload()}$("#termsModal").on("hidden.bs.modal",function(a){agreementChanged&&location.reload(!0)});$("#loginModal").on("shown.bs.modal",function(){$("#username").focus()});function isLoggedIn(a){a.success?location.reload(!0):a.error&&($("#loginError").slideDown(500),$("#loginErrorLabel").text(a.error))}var timeout=null;
$("#keyword").keydown(function(){clearTimeout(timeout);timeout=setTimeout(function(){refreshSearchResults()},750)});
function refreshSearchResults(){searchStartTime=Date.now();jQuery.ajax({type:"POST",data:jQuery("#searchForm").serialize(),url:"search/datasetSearch",success:function(a,b){$("#datasetSearchResults").html(a);populateCarousel()},error:function(a,b,c){}});jQuery.ajax({type:"POST",data:jQuery("#searchForm").serialize(),url:"search/sceneSearch",success:function(a,b){$("#sceneSearchResults").html(a)},error:function(a,b,c){}});return!1}
function adjustDatasetTabLabels(){var a=$("#searchDomainStudies").is(":checked"),b=$("#searchDomainReference").is(":checked");a?$("#studiesLabel").show():$("#studiesLabel").hide();b?$("#referenceLabel").show():$("#referenceLabel").hide();a&&b?$("#spacerLabel").show():$("#spacerLabel").hide()}
function addSearchFilter(){$.get("/search/searchFilter",function(a){$("#searchFilters").append(a);$(".categorySelect").change(function(){$(this).next().load("/tagging/categoryOptions",{category:$(this).val()},function(){$(".searchRefresh").change(function(){refreshSearchResults()});$(".searchRefreshText").on("input","input:text",function(){refreshSearchResults()});$(this).children().first().focus()})});$(".removeFilterButton").click(function(){$(this).parent().remove();refreshSearchResults()})});
updateRecentActivity()}function populateCarousel(){$(".carouselToPopulate").each(function(a,b){a=b.dataset.datasetid;b=parseInt(b.dataset.thumbnailsize);populateCarouselContents(a,b)})}function populateCarouselContents(a,b){$.ajax({type:"GET",url:"search/carouselContents/"+a+"?ts="+b,success:function(b,e){$("#innerCarousel"+a).html(b);loadSlideImage(a);changeSceneFileVisibility()},error:function(a,b,d){}})}
function loadPrevSlideImage(a){var b=parseInt($("#index"+a).val());0>b-1?$("#index"+a).val($("#lastIndex"+a).val()):$("#index"+a).val(b-1);loadSlideImage(a)}function loadNextSlideImage(a){var b=parseInt($("#index"+a).val());b+1>parseInt($("#lastIndex"+a).val())?$("#index"+a).val(0):$("#index"+a).val(b+1);loadSlideImage(a)}function loadSlideImage(a){var b=$("#index"+a).val();a=$("#"+a+"scenePreview"+b);b='<img src="/scene/image/'+a.attr("sceneImageId")+'">';a.html(b)}
function changeSceneFileVisibility(){var a=$("#visibilityControl").val();"Hide"===a&&$(".sceneFileAbove").removeClass("show");"Show"===a&&$(".sceneFileAbove").addClass("show")}function addTagHandle(a){var b=$("#"+a+" .tagHandle").val(),c=$("#"+a+" .tagValue").val();$("#"+a+" .handleContainer").append($("#tagHandleTemplate").html().replace(/TAGHANDLE/g,b).replace(/TAGVALUE/g,c));$("#"+a+" .tagHandle").val("");$("#"+a+" .tagValue").val("")};